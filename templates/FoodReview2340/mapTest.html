<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places API with Contact Info</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtYu97MeZ3EBsEGiHCg6UYPg-6e0p0JrQ
    &libraries=places"></script>
    <script>
        let map;
        let service;
        let currentInfoWindow = null;  // To track the currently open info window
        let markers = []; // To keep track of all the markers
        let pagination = null; // Track pagination object

        function initMap() {
            const atlanta = { lat: 33.74969690485657, lng: -84.39235565742148 }; // Atlanta location

            // Initialize the map
            map = new google.maps.Map(document.getElementById('map'), {
                center: atlanta,
                zoom: 15
            });

            // Initialize the Places service
            service = new google.maps.places.PlacesService(map);

            // Perform an initial search with default radius
            performSearch(1000);  // Default radius: 1000 meters
        }

        // Function to perform a nearby search with the given radius
        function performSearch(radius) {
            const atlanta = { lat: 33.74969690485657, lng: -84.39235565742148 };

            const request = {
                location: atlanta,
                radius: radius,
                type: ['restaurant']
            };

            // Clear existing markers from the map
            clearMarkers();

            // Perform nearby search
            service.nearbySearch(request, (results, status, paginationObject) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    results.forEach(place => {
                        // Create a marker for each restaurant
                        const marker = new google.maps.Marker({
                            map: map,
                            position: place.geometry.location,
                            title: place.name
                        });

                        // Store the marker in the markers array
                        markers.push(marker);

                        // Call function to get place details (including description, photo, and contact info)
                        getPlaceDetails(place.place_id, marker);
                    });

                    map.addListener('click', () => {
                        if (currentInfoWindow) {
                            currentInfoWindow.close();
                            currentInfoWindow = null;
                        }
                    });

                    pagination = paginationObject;
                    if (pagination && pagination.hasNextPage) {
                        document.getElementById('nextPage').disabled = false; // Enable Next Page button
                    } else {
                        document.getElementById('nextPage').disabled = true;  // Disable Next Page button if no more pages
                    }
                }
            });
        }

        // Function to load the next page of results
        function loadNextPage() {
            if (pagination && pagination.hasNextPage) {
                pagination.nextPage();
            }
        }

        // Function to get details of a place (including the description, photo, and contact info)
        function getPlaceDetails(placeId, marker) {
            const request = {
                placeId: placeId,
                fields: ['name', 'vicinity', 'rating', 'user_ratings_total', 'editorial_summary', 'photos', 'formatted_phone_number', 'website'] // Specify the fields you want
            };

            service.getDetails(request, (place, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    // Build the content for the info window
                    const description = place.editorial_summary ? place.editorial_summary.overview : 'No description available';

                    // Check if a photo is available
                    let photoUrl = '';
                    if (place.photos && place.photos.length > 0) {
                        // Get the URL for the first photo
                        photoUrl = place.photos[0].getUrl({ maxWidth: 300, maxHeight: 300 });
                    }

                    // Contact Info: Phone and Website
                    const phoneNumber = place.formatted_phone_number ? place.formatted_phone_number : 'No phone number available';
                    const website = place.website ? `<a href="${place.website}" target="_blank" style="color:blue;">Visit website</a>` : 'No website available';

                    const infoWindowContent = `
                        <div>
                            ${photoUrl ? `<img src="${photoUrl}" alt="${place.name}" style="max-width: 80%; height: auto;">` : ''}
                            <h3>${place.name}</h3>
                            <p>${place.vicinity}</p>
                            <p>Rating: ${place.rating || 'No rating available'}</p>
                            <p>${place.user_ratings_total || 'No'} reviews</p>
                            <p>${description}</p>
                            <p><strong>Phone:</strong> ${phoneNumber}</p>
                            <p><strong>Website:</strong> ${website}</p>
                        </div>
                    `;

                    const infoWindow = new google.maps.InfoWindow({
                        content: infoWindowContent
                    });

                    // Add a click listener to the marker
                    marker.addListener('click', () => {
                        // Close the previous info window if it's open
                        if (currentInfoWindow) {
                            currentInfoWindow.close();
                        }

                        // Open the clicked info window and set it as the current one
                        infoWindow.open(map, marker);
                        currentInfoWindow = infoWindow;
                    });
                }
            });
        }

        // Function to clear all markers from the map
        function clearMarkers() {
            for (let i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];
        }

        // Function to handle radius change and re-perform the search
        function updateRadius() {
            const newRadius = document.getElementById('radius').value;
            if (newRadius) {
                performSearch(parseInt(newRadius) * 1000);  // Convert km to meters
            }
        }
    </script>
</head>
<body onload="initMap()">
    <h1>Restaurants in Atlanta</h1>

    <!-- Map container -->
    <div id="map" style="height: 500px; width: 100%;"></div>

    <!-- Input field for radius -->
    <label for="radius">Radius (km):</label>
    <input type="number" id="radius" name="radius" placeholder="Enter radius in km">
    <button onclick="updateRadius()">Update Radius</button> <!-- Button to trigger radius update -->

    <!-- Next Page Button -->
    <button id="nextPage" onclick="loadNextPage()" disabled>Next Page</button> <!-- Disabled until pagination is available -->

</body>
</html>
